# ADR-0006: HLS proxied through our domain

- **Status**: Accepted
- **Date**: 2026-02-02

## Context
Мы не хостим видео. Мы получаем ссылки на HLS/стриминг у внешних провайдеров, но хотим:
- отдавать HLS с нашего домена (единый origin для клиента)
- контролировать доступ (entitlements/подписка)
- не раскрывать исходные ссылки напрямую
- иметь кэш и стабильность

## Decision
- Вводим **HLS Edge Proxy** (Nginx/Envoy) перед клиентом.
- Клиент получает только URL нашего домена вида `/hls/...?...`.
- Доступ контролируется через **подписанные URL** (HMAC + exp + bind to user/session).
- Edge проксирует на origin и применяет кэширование сегментов.

## Consequences
### Positive
- единый домен/SSL, проще CORS
- можно enforce подписку и ограничения
- можно кэшировать сегменты и снижать нагрузку

### Negative
- стоимость трафика и ответственность за bandwidth/egress
- нужно строго закрыть open-proxy сценарии
- требуется корректная поддержка range/headers

## Alternatives considered
- Отдавать прямые ссылки на origin: проще, но невозможно контролировать доступ и скрывать источники.
- Полный hosting видео: слишком дорого и юридически/операционно сложно.
